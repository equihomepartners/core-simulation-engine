openapi: 3.0.3
info:
  title: Equihome Fund Simulation Engine API
  description: |
    API for running fund simulations and analyzing results.

    The API provides endpoints for:
    - Creating and running simulations
    - Checking simulation status
    - Retrieving simulation results
    - Analyzing GP Entity economics
    - Real-time updates via WebSockets
  version: 2.3.0
  contact:
    name: Equihome Partners
servers:
  - url: /
    description: Default server
paths:
  /api/simulations/:
    get:
      summary: List Simulations
      description: |
        List all simulations.
      parameters:
        - name: status
          in: query
          description: Filter by status (created, running, completed, or failed)
          schema:
            type: string
            enum: [created, running, completed, failed, cancelled]
        - name: limit
          in: query
          description: Maximum number of simulations to return
          schema:
            type: integer
            default: 10
        - name: offset
          in: query
          description: Offset for pagination
          schema:
            type: integer
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimulationList'
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    post:
      summary: Create Simulation
      description: |
        Create and run a new simulation.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SimulationConfig'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimulationResponse'
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/simulations/{simulation_id}:
    get:
      summary: Get Simulation
      description: |
        Get a simulation by ID.

        This endpoint returns the simulation metadata including configuration
        parameters, status, and creation time. It doesn't include the full
        results, which are available through the /results endpoint.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimulationDetail'
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    delete:
      summary: Delete Simulation
      description: |
        Delete a simulation.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MonteCarloVisualization'
                properties:
                  message:
                    type: string
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/simulations/{simulation_id}/status:
    get:
      summary: Get Simulation Status
      description: |
        Get the status of a simulation.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
        - name: include_partial_results
          in: query
          description: Include partial results in the response
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimulationStatus'
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/simulations/{simulation_id}/results:
    get:
      summary: Get Simulation Results
      description: |
        Get the results of a completed simulation, supporting both yearly and monthly granularity.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
        - name: time_granularity
          in: query
          description: Time granularity for results (yearly or monthly)
          schema:
            type: string
            enum: [yearly, monthly]
            default: yearly
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimulationResults'
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/simulations/{simulation_id}/cancel:
    post:
      summary: Cancel Simulation
      description: |
        Cancel a running simulation without deleting its data.

        This endpoint stops the background processing of a simulation
        but keeps any partial results and marks the simulation as 'cancelled'.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  simulation_id:
                    type: string
                  status:
                    type: string
                  progress:
                    type: number
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/simulations/{simulation_id}/visualization:
    get:
      summary: Get Simulation Visualization
      description: |
        Get visualization data for a simulation, supporting both yearly and monthly granularity and advanced chart types.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
        - name: chart_type
          in: query
          description: Type of chart to retrieve (basic, fan, heatmap, tornado, multi_dim_sensitivity, correlation_matrix, etc.)
          schema:
            type: string
            default: all
        - name: time_granularity
          in: query
          description: Time granularity for time-series data
          schema:
            type: string
            default: yearly
        - name: cumulative
          in: query
          description: Whether to return cumulative data
          schema:
            type: boolean
            default: false
        - name: start_year
          in: query
          description: Start year for filtering
          schema:
            type: integer
        - name: end_year
          in: query
          description: End year for filtering
          schema:
            type: integer
        - name: format
          in: query
          description: Chart format (bar, line, pie, area, summary)
          schema:
            type: string
            default: bar
        - name: metrics
          in: query
          description: Comma-separated list of metrics to include
          schema:
            type: string
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                type: object
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/simulations/{simulation_id}/monte-carlo/visualization:
    get:
      summary: Get Monte Carlo Visualization
      description: Get Monte Carlo visualization data for a simulation.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
        - name: chart_type
          in: query
          description: Type of chart (distribution, sensitivity, confidence)
          schema:
            type: string
            default: distribution
        - name: format
          in: query
          description: Chart format (irr, multiple, default_rate)
          schema:
            type: string
            default: irr
        - name: metrics
          in: query
          description: Comma-separated list of metrics to include
          schema:
            type: string
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                type: object
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/simulations/{simulation_id}/variance-analysis:
    post:
      summary: Run Variance Analysis
      description: Run Monte Carlo variance analysis for an existing simulation configuration.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
        - name: num_inner_simulations
          in: query
          description: Number of Monte Carlo repetitions to run
          schema:
            type: integer
            default: 10
        - name: include_seed_results
          in: query
          description: Include individual seed results in the response
          schema:
            type: boolean
            default: false
        - name: include_seed_details
          in: query
          description: Include full cash flow and loan details for each seed
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VarianceAnalysisResults'
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/simulations/{simulation_id}/variance-analysis/seeds:
    get:
      summary: Get Variance Analysis Seeds
      description: Run Monte Carlo variance analysis and return individual seed results.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
        - name: num_inner_simulations
          in: query
          description: Number of Monte Carlo repetitions to run
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/simulations/{simulation_id}/variance-analysis/distribution:
    get:
      summary: Get Variance Analysis Distribution
      description: Run Monte Carlo variance analysis and return an IRR distribution histogram.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
        - name: num_inner_simulations
          in: query
          description: Number of Monte Carlo repetitions to run
          schema:
            type: integer
            default: 10
        - name: bins
          in: query
          description: Number of histogram bins
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                type: object
                properties:
                  bins:
                    type: array
                    items:
                      type: number
                  frequencies:
                    type: array
                    items:
                      type: integer
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'

  /api/simulations/{simulation_id}/variance-analysis/iterations:
    get:
      summary: Get Variance Iteration Metrics
      description: Return metrics for each iteration of the inner Monte Carlo loop.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
        - name: num_inner_simulations
          in: query
          description: Number of Monte Carlo repetitions to run
          schema:
            type: integer
            default: 10
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/simulations/{simulation_id}/variance-analysis/var-table:
    get:
      summary: Get Variance Analysis VaR Table
      description: Return Value-at-Risk metrics for specified confidence levels.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
        - name: num_inner_simulations
          in: query
          description: Number of Monte Carlo repetitions to run
          schema:
            type: integer
            default: 10
        - name: confidence_levels
          in: query
          description: Comma-separated VaR confidence levels (0-1)
          schema:
            type: string
            default: '0.95,0.99'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                type: object
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
>>>>>>> origin/2rp0bo-codex/audit-monte-carlo-flow-and-enhance-sdk
  /api/simulations/{simulation_id}/loans/:
    get:
      summary: Get Simulation Loans
      description: Get all loans with analytics for a simulation.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/simulations/{simulation_id}/loans/{loan_id}/:
    get:
      summary: Get Simulation Loan
      description: Get analytics for a single loan.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
        - name: loan_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                type: object
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/simulations/{simulation_id}/portfolio-evolution/:
    get:
      summary: Get Portfolio Evolution
      description: Get portfolio evolution time series for a simulation.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PortfolioEvolution'
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/simulations/{simulation_id}/recycling/:
    get:
      summary: Get Recycling Analytics
      description: Get recycling ratio and capital velocity for a simulation.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                type: object
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/simulations/{simulation_id}/cohorts/:
    get:
      summary: Get Cohort Analytics
      description: Get cohort/time-slice analytics for a simulation.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                type: object
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/simulations/{simulation_id}/export/:
    get:
      summary: Export Simulation
      description: Export simulation analytics as CSV or JSON.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
        - name: format
          in: query
          schema:
            type: string
            default: json
      responses:
        '200':
          description: Successful Response
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/health:
    get:
      summary: Health Check
      description: Health check endpoint.
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  timestamp:
                    type: string
  /api/traffic-light/zones:
    get:
      summary: List Zones
      description: "Return the complete Traffic-Light dataset (all suburb zone metrics)."
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ZoneMetrics'
  /api/traffic-light/zones/{zone_id}:
    get:
      summary: Get Zone
      description: "Return a single zone record by its suburb id."
      parameters:
        - name: zone_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ZoneMetrics'
        '404':
          description: Not found
  # ---------------------------------------------------------------------
  # Leverage – NAV facilities & deal-level notes
  # ---------------------------------------------------------------------
  /api/leverage/preview:
    post:
      summary: Leverage Preview
      description: |
        Quick, stateless calculation that returns interest expense and leverage
        metrics for a hypothetical NAV path and leverage configuration.  Used
        by the wizard's *what-if* panels.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LeveragePreviewRequest'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LeveragePreviewResponse'
  /api/leverage/metrics/{simulation_id}:
    get:
      summary: Leverage Metrics
      description: "Return leverage metrics for a completed simulation run."
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LeverageMetrics'
        '404':
          description: Not found
  # ---------------------------------------------------------------------
  # GP Entity Economics
  # ---------------------------------------------------------------------
  /gp-entity/{simulation_id}:
    get:
      summary: Get GP Entity Economics
      description: |
        Get the GP entity economics for a completed simulation.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GPEntityEconomicsResponse'
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'

  /gp-entity/{simulation_id}/basic:
    get:
      summary: Get GP Basic Economics
      description: Get the basic GP entity economics for a completed simulation.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BasicEconomicsResponse'
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'

  /gp-entity/{simulation_id}/management-company:
    get:
      summary: Get Management Company Metrics
      description: Get the management company metrics for a completed simulation.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ManagementCompanyResponse'
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'

  /gp-entity/{simulation_id}/team-economics:
    get:
      summary: Get Team Economics
      description: Get the team economics for a completed simulation.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TeamEconomicsResponse'
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'

  /gp-entity/{simulation_id}/gp-commitment:
    get:
      summary: Get GP Commitment
      description: Get the GP commitment for a completed simulation.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GPCommitmentResponse'
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'

  /gp-entity/{simulation_id}/cashflows:
    get:
      summary: Get GP Cashflows
      description: Get the GP entity cashflows for a completed simulation.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
        - name: frequency
          in: query
          description: Frequency of cashflows (yearly or monthly)
          schema:
            type: string
            default: yearly
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GPEntityCashflowsResponse'
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'

  /gp-entity/{simulation_id}/metrics:
    get:
      summary: Get GP Metrics
      description: Get the GP entity metrics for a completed simulation.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GPEntityMetricsResponse'
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'

  /gp-entity/{simulation_id}/visualization:
    get:
      summary: Get GP Visualization Data
      description: |
        Get visualization data for GP entity economics.
      parameters:
        - name: simulation_id
          in: path
          required: true
          schema:
            type: string
        - name: chart_type
          in: query
          description: Type of chart to retrieve
          schema:
            type: string
            default: all
        - name: time_granularity
          in: query
          description: Time granularity for time-series data
          schema:
            type: string
            default: yearly
        - name: cumulative
          in: query
          description: Whether to return cumulative data
          schema:
            type: boolean
            default: false
        - name: start_year
          in: query
          description: Start year for filtering
          schema:
            type: integer
        - name: end_year
          in: query
          description: End year for filtering
          schema:
            type: integer
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VisualizationDataResponse'
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'

  # ---------------------------------------------------------------------
  # Portfolio Optimization
  # ---------------------------------------------------------------------
  /api/optimization/:
    post:
      summary: Create Portfolio Optimization
      description: |
        Create and run a new portfolio optimization.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PortfolioOptimizationConfig'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PortfolioOptimizationResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'

  /api/optimization/{optimization_id}/efficient-frontier:
    get:
      summary: Get Efficient Frontier
      description: |
        Return efficient frontier data for a completed portfolio optimization.
      parameters:
        - name: optimization_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EfficientFrontierResponse'
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/optimization/{optimization_id}/efficient-frontier/details:
    get:
      summary: Get Efficient Frontier Details
      description: Return risk/return points with asset weights for each portfolio on the frontier.
      parameters:
        - name: optimization_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
        '404':
          description: Not found
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
components:
  schemas:
    HTTPValidationError:
      title: HTTPValidationError
      type: object
      properties:
        detail:
          title: Detail
          type: array
          items:
            $ref: '#/components/schemas/ValidationError'
    ValidationError:
      title: ValidationError
      type: object
      properties:
        loc:
          title: Location
          type: array
          items:
            anyOf:
              - type: string
              - type: integer
        msg:
          title: Message
          type: string
        type:
          title: Error Type
          type: string
    SimulationConfig:
      title: SimulationConfig
      description: Configuration for a simulation.
      type: object
      properties:
        fund_size:
          type: number
          description: Fund size in dollars
          default: 100000000
        fund_term:
          type: integer
          description: Fund term in years
          default: 10
        fund_id:
          type: string
          description: Unique identifier for a fund
          nullable: true
        fund_group:
          type: string
          description: Group identifier for multi-fund setups
          nullable: true
        tranche_id:
          type: string
          description: Tranche identifier if using tranches
          nullable: true
        gp_commitment_percentage:
          type: number
          description: GP commitment percentage (0-1)
          default: 0.05
        hurdle_rate:
          type: number
          description: Hurdle rate (0-1)
          default: 0.08
        carried_interest_rate:
          type: number
          description: Carried interest rate (0-1)
          default: 0.20
        waterfall_structure:
          type: string
          description: Waterfall structure (european or american)
          default: european
        monte_carlo_enabled:
          type: boolean
          description: Enable Monte Carlo simulation
          default: false
        optimization_enabled:
          type: boolean
          description: Enable portfolio optimization
          default: false
        stress_testing_enabled:
          type: boolean
          description: Enable stress testing
          default: false
        external_data_enabled:
          type: boolean
          description: Enable external data sources
          default: false
        generate_reports:
          type: boolean
          description: Generate reports
          default: true
        base_appreciation_rate:
          type: number
          description: Base appreciation rate (0-1)
          default: 0.03
        appreciation_volatility:
          type: number
          description: Appreciation volatility (0-1)
          default: 0.02
        base_default_rate:
          type: number
          description: Base default rate (0-1)
          default: 0.01
        default_volatility:
          type: number
          description: Default volatility (0-1)
          default: 0.005
        correlation:
          type: number
          description: Correlation between appreciation and default rates (-1 to 1)
          default: 0.3
        avg_loan_size:
          type: integer
          description: Average loan size in dollars
          default: 250000
        loan_size_std_dev:
          type: integer
          description: Standard deviation of loan size in dollars
          default: 50000
        min_loan_size:
          type: integer
          description: Minimum loan size in dollars
          default: 100000
        max_loan_size:
          type: integer
          description: Maximum loan size in dollars
          default: 500000
        avg_loan_term:
          type: integer
          description: Average loan term in years
          default: 5
        avg_loan_interest_rate:
          type: number
          description: Average loan interest rate (0-1)
          default: 0.06
        avg_loan_ltv:
          type: number
          description: Average loan LTV (0-1)
          default: 0.75
        zone_allocations:
          type: object
          description: Zone allocations (must sum to 1)
          default:
            green: 0.6
            orange: 0.3
            red: 0.1
          additionalProperties:
            type: number
        management_fee_rate:
          type: number
          description: Management fee rate (0-1)
          default: 0.02
        management_fee_basis:
          type: string
          description: Management fee basis (committed_capital, invested_capital, or nav)
          default: committed_capital
        distribution_frequency:
          type: string
          description: Distribution frequency (annual, quarterly, or monthly)
          default: annual
        distribution_policy:
          type: string
          description: Distribution policy (available_cash, income_only, return_of_capital, or reinvestment_priority)
          default: available_cash
        reinvestment_period:
          type: integer
          description: Reinvestment period in years
          default: 5
        avg_loan_exit_year:
          type: number
          description: Average loan exit year
          default: 7
        exit_year_std_dev:
          type: number
          description: Standard deviation of exit year
          default: 1.5
        early_exit_probability:
          type: number
          description: Probability of early exit (0-1)
          default: 0.3
        num_simulations:
          type: integer
          description: Number of Monte Carlo simulations
          default: 1000
        variation_factor:
          type: number
          description: Variation factor for Monte Carlo simulation (0-1)
          default: 0.1
        monte_carlo_seed:
          type: integer
          description: Seed for Monte Carlo simulation
          nullable: true
        optimization_objective:
          type: string
          description: Optimization objective (max_sharpe, min_volatility, efficient_risk, or efficient_return)
          default: max_sharpe
        risk_free_rate:
          type: number
          description: Risk-free rate for Sharpe ratio calculation (0-1)
          default: 0.03
        geo_strategy:
          type: string
          description: Geographical allocation strategy (simple/profile/explicit)
          enum: [simple, profile, explicit]
          default: simple
        zone_profiles:
          type: object
          description: Named groupings of suburb IDs with target weights
          additionalProperties:
            type: object
            properties:
              ids:
                type: array
                items:
                  type: string
              weight:
                type: number
            required: [ids, weight]
        risk_weight_table:
          type: object
          description: Override risk weights by suburb id
          additionalProperties:
            type: number
        min_allocation:
          type: number
          description: Minimum allocation for optimization (0-1)
          default: 0.0
        max_allocation:
          type: number
          description: Maximum allocation for optimization (0-1)
          default: 1.0
        stress_config:
          type: object
          description: Stress testing configuration
          default:
            individual_scenarios:
              recession:
                appreciation_rate: -0.05
                default_rate: 0.05
              high_default:
                appreciation_rate: 0.01
                default_rate: 0.08
              low_appreciation:
                appreciation_rate: 0.01
                default_rate: 0.02
            combined_scenarios:
              recession_high_default:
                - appreciation_rate: -0.05
                - default_rate: 0.08
        report_config:
          type: object
          description: Report configuration
          default:
            report_template: summary
            export_format: json
            include_charts: true
        leverage:
          $ref: '#/components/schemas/LeverageConfig'
        deployment_monthly_granularity:
          type: boolean
          description: Use monthly granularity for deployment/exit
          default: false
        time_granularity:
          type: string
          description: Time granularity for simulation (yearly or monthly)
          enum: [yearly, monthly]
          default: yearly
        leverage:
          $ref: '#/components/schemas/LeverageConfig'
    SimulationResponse:
      title: SimulationResponse
      description: Response for a simulation creation request.
      type: object
      required:
        - simulation_id
        - status
      properties:
        simulation_id:
          type: string
          description: Unique ID for the simulation
        status:
          type: string
          description: Status of the simulation (created, running, completed, or failed)
    SimulationStatus:
      title: SimulationStatus
      description: Status of a simulation.
      type: object
      required:
        - simulation_id
        - status
        - progress
        - created_at
        - updated_at
      properties:
        simulation_id:
          type: string
          description: Unique ID for the simulation
        status:
          type: string
          description: Status of the simulation (created, running, completed, failed, or cancelled)
        progress:
          type: number
          description: Progress of the simulation (0-1)
        current_step:
          type: string
          description: Current step of the simulation
          nullable: true
        estimated_completion_time:
          type: number
          description: Estimated completion time (Unix timestamp)
          nullable: true
        created_at:
          type: number
          description: Creation time (Unix timestamp)
        updated_at:
          type: number
          description: Last update time (Unix timestamp)
        partial_results:
          type: object
          description: Partial results if available
          nullable: true
    SimulationDetail:
      title: SimulationDetail
      description: Detailed information about a simulation.
      type: object
      required:
        - simulation_id
        - status
      properties:
        simulation_id:
          type: string
          description: Unique ID for the simulation
        name:
          type: string
          description: Name of the simulation
        description:
          type: string
          description: Description of the simulation
        status:
          type: string
          description: Status of the simulation (created, running, completed, failed, or cancelled)
        progress:
          type: number
          description: Progress of the simulation (0-1)
        current_step:
          type: string
          description: Current step of the simulation
          nullable: true
        created_at:
          type: number
          description: Creation time (Unix timestamp)
        updated_at:
          type: number
          description: Last update time (Unix timestamp)
        config:
          $ref: '#/components/schemas/SimulationConfig'
        error:
          type: object
          description: Error information if the simulation failed
          nullable: true
          properties:
            message:
              type: string
              description: Error message
            details:
              type: object
              description: Error details
              nullable: true
    SimulationList:
      title: SimulationList
      description: List of simulations with pagination info.
      type: object
      required:
        - simulations
        - total
        - limit
        - offset
      properties:
        simulations:
          type: array
          description: List of simulations
          items:
            type: object
            properties:
              simulation_id:
                type: string
                description: Unique ID for the simulation
              status:
                type: string
                description: Status of the simulation
              progress:
                type: number
                description: Progress of the simulation (0-1)
              created_at:
                type: number
                description: Creation time (Unix timestamp)
              updated_at:
                type: number
                description: Last update time (Unix timestamp)
        total:
          type: integer
          description: Total number of simulations matching the filter
        limit:
          type: integer
          description: Maximum number of simulations returned
        offset:
          type: integer
          description: Offset for pagination
    PerformanceMetrics:
      title: PerformanceMetrics
      description: Performance metrics for a simulation.
      type: object
      properties:
        irr:
          type: number
          description: Internal Rate of Return
        moic:
          type: number
          description: Multiple on Invested Capital
        roi:
          type: number
          description: Return on Investment
        payback_period:
          type: number
          description: Payback Period in years
        tvpi:
          type: number
          description: Total Value to Paid-In
        dpi:
          type: number
          description: Distributions to Paid-In
        rvpi:
          type: number
          description: Residual Value to Paid-In
        pic:
          type: number
          description: Paid-In Capital
        lpIrr:
          type: number
          description: LP Internal Rate of Return
        lpMultiple:
          type: number
          description: LP Multiple on Invested Capital
        gpIrr:
          type: number
          description: GP Internal Rate of Return
        defaultRate:
          type: number
          description: Default Rate
        sharpeRatio:
          type: number
          description: Sharpe Ratio
        sortinoRatio:
          type: number
          description: Sortino Ratio
        maxDrawdown:
          type: number
          description: Maximum Drawdown
        alpha:
          type: number
          description: Alpha
        beta:
          type: number
          description: Beta
        distributionYield:
          type: number
          description: Distribution Yield
        totalCapitalCalls:
          type: number
          description: Total Capital Calls
        totalDistributions:
          type: number
          description: Total Distributions
        netCashFlow:
          type: number
          description: Net Cash Flow
        ytdCashFlow:
          type: number
          description: Year-to-Date Cash Flow
        reinvestmentCount:
          type: number
          description: Reinvestment Count
        reinvestmentAmount:
          type: number
          description: Reinvestment Amount
        reinvestmentRate:
          type: number
          description: Reinvestment Rate
        zoneAllocation:
          type: object
          description: Zone Allocation
          properties:
            green:
              type: number
              description: Green Zone Allocation
            orange:
              type: number
              description: Orange Zone Allocation
            red:
              type: number
              description: Red Zone Allocation
    CashFlowPeriod:
      title: CashFlowPeriod
      description: Cash flow data for a single period.
      type: object
      properties:
        year:
          type: number
          description: Year or period number
        capitalCalls:
          type: number
          description: Capital calls for the period
        distributions:
          type: number
          description: Distributions for the period
        net:
          type: number
          description: Net cash flow for the period
    PortfolioPeriod:
      title: PortfolioPeriod
      description: Portfolio data for a single period.
      type: object
      properties:
        year:
          type: number
          description: Year or period number
        activeLoans:
          type: number
          description: Number of active loans
        exitedLoans:
          type: number
          description: Number of exited loans
        newLoans:
          type: number
          description: Number of new loans
        defaultedLoans:
          type: number
          description: Number of defaulted loans
        reinvestments:
          type: number
          description: Number of reinvestments
        reinvestedAmount:
          type: number
          description: Amount reinvested
        portfolioValue:
          type: number
          description: Portfolio value
    PortfolioEvolution:
      title: PortfolioEvolution
      description: Portfolio evolution over time.
      type: object
      properties:
        years:
          type: array
          description: Years or periods
          items:
            type: number
        active_loans:
          type: array
          description: Number of active loans by period
          items:
            type: number
        new_loans:
          type: array
          description: Number of new loans by period
          items:
            type: number
        exited_loans:
          type: array
          description: Number of exited loans by period
          items:
            type: number
        defaulted_loans:
          type: array
          description: Number of defaulted loans by period
          items:
            type: number
        reinvestments:
          type: array
          description: Number of reinvestments by period
          items:
            type: number
        reinvested_amount:
          type: array
          description: Amount reinvested by period
          items:
            type: number
    SimulationResults:
      title: SimulationResults
      description: Results of a simulation.
      type: object
      properties:
        id:
          type: string
          description: Simulation ID
        status:
          type: string
          description: Status of the simulation
        message:
          type: string
          description: Status message
        partial_results:
          type: boolean
          description: Whether these are partial results
        progress:
          type: number
          description: Progress of the simulation (0-1)
        generated_at:
          type: string
          format: date-time
          description: Timestamp when results were generated
        metrics:
          $ref: '#/components/schemas/PerformanceMetrics'
        performance_metrics:
          $ref: '#/components/schemas/PerformanceMetrics'
        cash_flows:
          type: object
          description: Cash flow data
          properties:
            years:
              type: array
              description: Years or periods
              items:
                type: number
            capital_called:
              type: array
              description: Capital called by period
              items:
                type: number
            distributions:
              type: array
              description: Distributions by period
              items:
                type: number
            net_cash_flow:
              type: array
              description: Net cash flow by period
              items:
                type: number
            cumulative_capital_called:
              type: array
              description: Cumulative capital called by period
              items:
                type: number
            cumulative_distributions:
              type: array
              description: Cumulative distributions by period
              items:
                type: number
            cumulative_net_cash_flow:
              type: array
              description: Cumulative net cash flow by period
              items:
                type: number
        portfolio:
          $ref: '#/components/schemas/PortfolioEvolution'
        yearly_portfolio:
          $ref: '#/components/schemas/PortfolioEvolution'
        monthly_portfolio:
          $ref: '#/components/schemas/PortfolioEvolution'
        monthly_cash_flows:
          type: object
          description: Monthly cash flow data
        waterfall_results:
          type: object
          description: Waterfall distribution results
        monte_carlo_results:
<<<<<<< HEAD
          $ref: '#/components/schemas/MonteCarloResults'
=======
          type: object
          description: Monte Carlo simulation results
>>>>>>> pr-12
        leverage_metrics:
          $ref: '#/components/schemas/LeverageMetrics'
        bootstrap_results:
          $ref: '#/components/schemas/BootstrapResults'
        grid_stress_results:
          $ref: '#/components/schemas/GridStressResults'
        vintage_var:
          $ref: '#/components/schemas/VintageVarResults'
        leverage:
        leverage_metrics:
          $ref: '#/components/schemas/LeverageMetrics'
        fund_size:
          type: number
          description: Fund size
        config:
          $ref: '#/components/schemas/SimulationConfig'
    BootstrapResults:
      title: BootstrapResults
      description: Results of bootstrap sequencing risk analysis.
      type: object
      properties:
        status:
          type: string
          description: Status of the bootstrap analysis (success, skipped, error)
        iterations:
          type: integer
          description: Number of bootstrap iterations
        irr_distribution:
          type: array
          description: Distribution of IRR values from bootstrap samples
          items:
            type: number
        mean_irr:
          type: number
          description: Mean IRR across all bootstrap samples
        percentile_5:
          type: number
          description: 5th percentile IRR
        percentile_95:
          type: number
          description: 95th percentile IRR
    GridStressResults:
      title: GridStressResults
      description: Results of 2-D parameter grid stress analysis.
      type: object
      properties:
        axis_x:
          type: string
          description: Name of the parameter varied along the X-axis
        axis_y:
          type: string
          description: Name of the parameter varied along the Y-axis
        factors:
          type: array
          description: Scaling factors applied to the baseline for each axis
          items:
            type: number
        irr_matrix:
          type: array
          description: Matrix of IRR values; rows correspond to Y-axis factors, columns to X-axis factors
          items:
            type: array
            items:
              type: number
    VintageVarResults:
      title: VintageVarResults
      description: Value-at-Risk by origination vintage derived from Monte-Carlo simulations.
      type: object
      properties:
        status:
          type: string
          description: Status of the analysis (success, skipped, error)
        vintage_var:
          type: object
          description: Mapping of vintage year to VaR information
          additionalProperties:
            type: object
            properties:
              percentile:
                type: number
                description: Percentile used for VaR (e.g. 5)
              value_at_risk:
                type: number
                description: IRR at the specified downside percentile
    VarianceAnalysisResults:
      title: VarianceAnalysisResults
      description: Aggregated IRR and VaR statistics from multi-seed variance analysis.
      type: object
      properties:
        iterations:
          type: integer
          description: Number of inner simulations executed
        irr_percentiles:
          type: object
          properties:
            p5: { type: number }
            p50: { type: number }
            p95: { type: number }
        var_percentiles:
          type: object
          properties:
            p95: { type: number }
            p99: { type: number }
        seed_results:
          type: array
          items:
            type: object
            properties:
              seed: { type: integer }
              irr: { type: number }
        seed_details:
          type: array
          items:
            type: object
            properties:
              seed: { type: integer }
              irr: { type: number }
              cash_flows:
                type: object
                description: Cash flow table for the run
              loans:
                type: array
                items:
                  type: object
    ZoneMetrics:
      title: ZoneMetrics
      description: Traffic-Light metrics for a single suburb / zone.
      type: object
      required: [id, name, zone_color]
      properties:
        id:
          type: string
          description: Suburb slug (snake-case)
        name:
          type: string
          description: Human-readable suburb name
        zone_color:
          type: string
          description: TLS bucket (green, orange, red)
        growth_mu:
          type: number
          nullable: true
        growth_sigma:
          type: number
          nullable: true
        default_mu:
          type: number
          nullable: true
        default_sigma:
          type: number
          nullable: true
        liquidity_score:
          type: number
          nullable: true
        risk_weight:
          type: number
          nullable: true
        # Additional properties are allowed for extended metrics
      additionalProperties: true
    # -----------------------------------------------------------------
    # Leverage schemas
    # -----------------------------------------------------------------
    LeverageConfig:
      title: LeverageConfig
      description: Configuration block for leverage facilities.
      type: object
      properties:
        green_sleeve:
          type: object
          properties:
            enabled: { type: boolean }
            max_mult: { type: number }
            spread_bps: { type: integer }
            commitment_fee_bps: { type: integer }
        a_plus_overadvance:
          type: object
          properties:
            enabled: { type: boolean }
            tls_grade: { type: string }
            advance_rate: { type: number }
        deal_note:
          type: object
          properties:
            enabled: { type: boolean }
            note_pct: { type: number }
            note_rate: { type: number }
        ramp_line:
          type: object
          properties:
            enabled: { type: boolean }
            limit_pct_commit: { type: number }
            draw_period_months: { type: integer }
            spread_bps: { type: integer }
        dynamic_rules:
          type: array
          items:
            type: object
            properties:
              trigger: { type: string }
              action: { type: string }
              max: { type: number }

    LeveragePreviewRequest:
      title: LeveragePreviewRequest
      type: object
      required: [nav_by_year, config]
      properties:
        nav_by_year:
          type: object
          additionalProperties:
            type: number
          description: Mapping of year→NAV
        config:
          $ref: '#/components/schemas/LeverageConfig'

    LeveragePreviewResponse:
      title: LeveragePreviewResponse
      type: object
      properties:
        cash_flows:
          type: object
          additionalProperties:
            type: object
            properties:
              interest:
                type: number
              commitment_fee:
                type: number
        metrics:
          $ref: '#/components/schemas/LeverageMetrics'

    LeverageMetrics:
      title: LeverageMetrics
      type: object
      properties:
        avg_leverage:
          type: number
        max_drawn:
          type: number
        total_interest:
          type: number


    MonteCarloHistogramBin:
      title: MonteCarloHistogramBin
      type: object
      properties:
        bin:
          type: number
        frequency:
          type: number

    MonteCarloDistributionSummary:
      title: MonteCarloDistributionSummary
      type: object
      properties:
        min:
          type: number
        max:
          type: number
        mean:
          type: number
        median:
          type: number
        stdDev:
          type: number
        percentiles:
          type: object
          properties:
            p10:
              type: number
            p25:
              type: number
            p50:
              type: number
            p75:
              type: number
            p90:
              type: number
        histogram:
          type: array
          items:
            $ref: '#/components/schemas/MonteCarloHistogramBin'

    MonteCarloResults:
      title: MonteCarloResults
      description: Results from Monte Carlo simulations.
      type: object
      properties:
        distributions:
          type: object
          properties:
            irr:
              $ref: '#/components/schemas/MonteCarloDistributionSummary'
            multiple:
              $ref: '#/components/schemas/MonteCarloDistributionSummary'
            default_rate:
              $ref: '#/components/schemas/MonteCarloDistributionSummary'
        sensitivity:
          type: array
          items:
            type: object
            properties:
              parameter:
                type: string
              impact:
                type: number
              correlation:
                type: number
        efficient_frontier:
          type: array
          items:
            type: object
        convergence:
          type: object
          properties:
            running_mean:
              type: array
              items:
                type: number
            running_ci:
              type: array
              items:
                type: number
        factor_decomposition:
          type: object
        num_simulations:
          type: integer
        variation_factor:
          type: number
        time_granularity:
          type: string
        simulation_results:
          type: array
          items:
            type: object
        errors:
          type: array
          items:
            type: object

    MonteCarloChartDataset:
      title: MonteCarloChartDataset
      type: object
      properties:
        label:
          type: string
        data:
          type: array
          items:
            type: number
        color:
          type: string
          nullable: true

    MonteCarloStatistics:
      title: MonteCarloStatistics
      type: object
      properties:
        min:
          type: number
          nullable: true
        max:
          type: number
          nullable: true
        mean:
          type: number
          nullable: true
        median:
          type: number
          nullable: true
        std_dev:
          type: number
          nullable: true
        percentiles:
          type: object
          properties:
            p10:
              type: number
              nullable: true
            p25:
              type: number
              nullable: true
            p50:
              type: number
              nullable: true
            p75:
              type: number
              nullable: true
            p90:
              type: number
              nullable: true

    MonteCarloDistributionModel:
      title: MonteCarloDistributionModel
      type: object
      properties:
        labels:
          type: array
          items:
            type: number
        datasets:
          type: array
          items:
            $ref: '#/components/schemas/MonteCarloChartDataset'
        statistics:
          $ref: '#/components/schemas/MonteCarloStatistics'

    MonteCarloSensitivityModel:
      title: MonteCarloSensitivityModel
      type: object
      properties:
        labels:
          type: array
          items:
            type: string
        datasets:
          type: array
          items:
            $ref: '#/components/schemas/MonteCarloChartDataset'

    MonteCarloConfidenceModel:
      title: MonteCarloConfidenceModel
      type: object
      properties:
        mean:
          type: number
          nullable: true
        median:
          type: number
          nullable: true
        confidence_intervals:
          type: object
          properties:
            p10_p90:
              type: array
              minItems: 2
              maxItems: 2
              items:
                type: number
                nullable: true
            p25_p75:
              type: array
              minItems: 2
              maxItems: 2
              items:
                type: number
                nullable: true

    MonteCarloVisualization:
      title: MonteCarloVisualization
      oneOf:
        - $ref: '#/components/schemas/MonteCarloDistributionModel'
        - $ref: '#/components/schemas/MonteCarloSensitivityModel'
        - $ref: '#/components/schemas/MonteCarloConfidenceModel'

    # -----------------------------------------------------------------
    # GP Entity schemas
    # -----------------------------------------------------------------
    CashflowResponse:
      title: CashflowResponse
      type: object
      properties:
        management_fees:
          type: number
        carried_interest:
          type: number
        origination_fees:
          type: number
        additional_revenue:
          type: number
        total_revenue:
          type: number
        base_expenses:
          type: number
        custom_expenses:
          type: number
        expense_breakdown:
          type: object
          additionalProperties:
            type: number
        total_expenses:
          type: number
        net_income:
          type: number
        dividend:
          type: number
        cash_reserve:
          type: number

    GPEntityCashflowsResponse:
      title: GPEntityCashflowsResponse
      type: object
      properties:
        yearly:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/CashflowResponse'
        monthly:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/CashflowResponse'

    FundCommitmentResponse:
      title: FundCommitmentResponse
      type: object
      properties:
        commitment:
          type: number
        return:
          type: number
        multiple:
          type: number
        roi:
          type: number

    GPCommitmentResponse:
      title: GPCommitmentResponse
      type: object
      properties:
        total_commitment:
          type: number
        total_return:
          type: number
        multiple:
          type: number
        roi:
          type: number
        by_fund:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/FundCommitmentResponse'

    BasicEconomicsResponse:
      title: BasicEconomicsResponse
      type: object
      properties:
        total_management_fees:
          type: number
        total_origination_fees:
          type: number
        total_carried_interest:
          type: number
        total_catch_up:
          type: number
        total_return_of_capital:
          type: number
        total_distributions:
          type: number
        total_revenue:
          type: number
        yearly_management_fees:
          type: object
          additionalProperties:
            type: number
        yearly_carried_interest:
          type: object
          additionalProperties:
            type: number
        yearly_distributions:
          type: object
          additionalProperties:
            type: number
        yearly_origination_fees:
          type: object
          additionalProperties:
            type: number
        yearly_total_revenue:
          type: object
          additionalProperties:
            type: number

    ExpenseBreakdownResponse:
      title: ExpenseBreakdownResponse
      type: object
      properties:
        base:
          type: number
        staff:
          type: number
        office:
          type: number
        technology:
          type: number
        marketing:
          type: number
        legal:
          type: number
        other:
          type: number
        scaled:
          type: number

    StaffGrowthResponse:
      title: StaffGrowthResponse
      type: object
      additionalProperties:
        type: object
        additionalProperties:
          type: integer

    ManagementCompanyResponse:
      title: ManagementCompanyResponse
      type: object
      properties:
        yearly_expenses:
          type: object
          additionalProperties:
            type: number
        total_expenses:
          type: number
        yearly_additional_revenue:
          type: object
          additionalProperties:
            type: number
        total_additional_revenue:
          type: number
        expense_breakdown:
          $ref: '#/components/schemas/ExpenseBreakdownResponse'
        staff_growth:
          $ref: '#/components/schemas/StaffGrowthResponse'
        yearly_aum:
          type: object
          additionalProperties:
            type: number
        yearly_fund_count:
          type: object
          additionalProperties:
            type: integer
        yearly_loan_count:
          type: object
          additionalProperties:
            type: integer

    TeamEconomicsResponse:
      title: TeamEconomicsResponse
      type: object
      properties:
        partner_carried_interest:
          type: object
          additionalProperties:
            type: number
        employee_carried_interest:
          type: object
          additionalProperties:
            type: number
        partner_management_fees:
          type: object
          additionalProperties:
            type: number
        employee_management_fees:
          type: object
          additionalProperties:
            type: number
        partner_origination_fees:
          type: object
          additionalProperties:
            type: number
        employee_origination_fees:
          type: object
          additionalProperties:
            type: number
        partner_total_compensation:
          type: object
          additionalProperties:
            type: number
        employee_total_compensation:
          type: object
          additionalProperties:
            type: number
        total_partner_allocation:
          type: number
        total_employee_allocation:
          type: number
        yearly_allocations:
          type: object
          additionalProperties:
            type: object

    GPEntityMetricsResponse:
      title: GPEntityMetricsResponse
      type: object
      properties:
        total_revenue:
          type: number
        total_expenses:
          type: number
        total_net_income:
          type: number
        profit_margin:
          type: number
        revenue_cagr:
          type: number
        expense_cagr:
          type: number
        net_income_cagr:
          type: number
        revenue_per_employee:
          type: number
        profit_per_employee:
          type: number
        irr:
          type: number
        payback_period:
          type: integer

    VisualizationDataResponse:
      title: VisualizationDataResponse
      type: object
      additionalProperties: true

    # -----------------------------------------------------------------
    # Portfolio Optimization schemas
    # -----------------------------------------------------------------
    PortfolioOptimizationConfig:
      title: PortfolioOptimizationConfig
      type: object
      properties:
        base_config:
          $ref: '#/components/schemas/SimulationConfig'
        optimization_target:
          type: string
          enum: [irr, multiple, default_rate, sharpe]
          default: irr
        constraint_params:
          type: object
          properties:
            min_irr:
              type: number
            max_default_rate:
              type: number
            min_multiple:
              type: number
        variable_params:
          type: array
          items:
            type: object
            properties:
              param_name:
                type: string
              min_value:
                type: number
              max_value:
                type: number
              step_size:
                type: number
        num_points:
          type: integer
          default: 10

    PortfolioOptimizationResponse:
      title: PortfolioOptimizationResponse
      type: object
      properties:
        optimization_id:
          type: string
        status:
          type: string
          enum: [pending, running, completed, failed]
        message:
          type: string
        progress:
          type: number

    EfficientFrontierPoint:
      title: EfficientFrontierPoint
      type: object
      properties:
        config:
          type: object
        metrics:
          type: object
          properties:
            irr:
              type: number
            multiple:
              type: number
            default_rate:
              type: number
            sharpe:
              type: number

    EfficientFrontierResponse:
      title: EfficientFrontierResponse
      type: object
      properties:
        optimization_id:
          type: string
        target:
          type: string
        points:
          type: array
          items:
            $ref: '#/components/schemas/EfficientFrontierPoint'
        pareto_frontier:
          type: array
          items:
            $ref: '#/components/schemas/EfficientFrontierPoint'

    GPEntityEconomicsResponse:
      title: GPEntityEconomicsResponse
      type: object
      properties:
        basic_economics:
          $ref: '#/components/schemas/BasicEconomicsResponse'
        management_company:
          $ref: '#/components/schemas/ManagementCompanyResponse'
        team_economics:
          $ref: '#/components/schemas/TeamEconomicsResponse'
        gp_commitment:
          $ref: '#/components/schemas/GPCommitmentResponse'
        cashflows:
          $ref: '#/components/schemas/GPEntityCashflowsResponse'
        metrics:
          $ref: '#/components/schemas/GPEntityMetricsResponse'
        visualization_data:
          $ref: '#/components/schemas/VisualizationDataResponse'


    SectorConstraint:
      title: SectorConstraint
      type: object
      required: [name, asset_indices]
      properties:
        name:
          type: string
        asset_indices:
          type: array
          items:
            type: integer
        min_weight:
          type: number
        max_weight:
          type: number

    PortfolioOptimizationConfig:
      title: PortfolioOptimizationConfig
      type: object
      required: [historical_returns]
      properties:
        historical_returns:
          type: array
          description: Historical returns (assets in columns, time in rows)
          items:
            type: array
            items:
              type: number
        asset_names:
          type: array
          items:
            type: string
          description: Names of assets
        risk_model:
          type: string
          description: Risk model to use
          enum: [sample, exp, ledoit_wolf, oas, semi]
        returns_model:
          type: string
          description: Returns model to use
          enum: [mean, ema, capm]
        objective:
          type: string
          description: Optimization objective
          enum: [sharpe, min_risk, target_return, target_risk, utility]
        risk_free_rate:
          type: number
          description: Risk-free rate (0-1)
        target_return:
          type: number
          nullable: true
          description: Target return for target_return objective (0-1)
        target_risk:
          type: number
          nullable: true
          description: Target risk for target_risk objective (0-1)
        risk_aversion:
          type: number
          description: Risk aversion parameter for utility objective
        min_weight:
          type: number
          description: Minimum weight for each asset (0-1)
        max_weight:
          type: number
          description: Maximum weight for each asset (0-1)
        sector_constraints:
          type: array
          items:
            $ref: '#/components/schemas/SectorConstraint'
          description: Sector constraints
        generate_efficient_frontier:
          type: boolean
          description: Generate efficient frontier
        efficient_frontier_points:
          type: integer
          description: Number of points on the efficient frontier
        frequency:
          type: integer
          description: Number of periods in a year

    PortfolioOptimizationResponse:
      title: PortfolioOptimizationResponse
      type: object
      properties:
        optimization_id:
          type: string
        status:
          type: string

    EfficientFrontierResponse:
      title: EfficientFrontierResponse
      type: object
      properties:
        optimization_id:
          type: string
        returns:
          type: array
          items:
            type: number
        risks:
          type: array
          items:
            type: number
        weights:
          type: array
          items:
            type: array
            items:
              type: number
