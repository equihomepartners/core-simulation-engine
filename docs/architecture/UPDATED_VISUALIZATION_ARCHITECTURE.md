# Updated Visualization Architecture

## System Architecture with Enhanced Visualization Layer

```
┌────────────────────────────────────────────────────────────────────┐
│                      CLIENT APPLICATION                            │
│                                                                    │
│  ┌────────────────────────────────────────────────────────────┐   │
│  │                  VISUALIZATION LAYER                        │   │
│  │                                                            │   │
│  │  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌──────────┐ │   │
│  │  │ Financial │  │ Risk      │  │ Portfolio │  │ Waterfall│ │   │
│  │  │ Metrics   │  │ Metrics   │  │ Analysis  │  │ Charts   │ │   │
│  │  └───────────┘  └───────────┘  └───────────┘  └──────────┘ │   │
│  │                                                            │   │
│  │  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌──────────┐ │   │
│  │  │ Zone      │  │ Loan      │  │ Monte     │  │ Raw Data │ │   │
│  │  │ Performance│  │Performance│  │ Carlo     │  │ Viewer   │ │   │
│  │  └───────────┘  └───────────┘  └───────────┘  └──────────┘ │   │
│  │                                                            │   │
│  └────────────────────────────────────────────────────────────┘   │
│                                                                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐    │
│  │ Simulation  │  │ Parameter   │  │ Data Transformation     │    │
│  │ Controls    │  │ Selection   │  │ & Formatting            │    │
│  └─────────────┘  └─────────────┘  └─────────────────────────┘    │
└────────────────────────────┬───────────────────────────────────────┘
                             │
                             ▼
┌────────────────────────────────────────────────────────────────────┐
│                      VISUALIZATION API LAYER                       │
│                                                                    │
│  ┌────────────────────────────────────────────────────────────┐   │
│  │                  CORE VISUALIZATION ENDPOINTS              │   │
│  │                                                            │   │
│  │  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌──────────┐ │   │
│  │  │ Key Metrics│  │ Cashflow  │  │ Portfolio │  │ Risk     │ │   │
│  │  │ Endpoint  │  │ Endpoint  │  │ Endpoint  │  │ Endpoint │ │   │
│  │  └───────────┘  └───────────┘  └───────────┘  └──────────┘ │   │
│  │                                                            │   │
│  │  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌──────────┐ │   │
│  │  │ Waterfall │  │ Zone      │  │ Loan      │  │ Raw Data │ │   │
│  │  │ Endpoint  │  │ Endpoint  │  │ Endpoint  │  │ Endpoint │ │   │
│  │  └───────────┘  └───────────┘  └───────────┘  └──────────┘ │   │
│  └────────────────────────────────────────────────────────────┘   │
│                                                                    │
│  ┌────────────────────────────────────────────────────────────┐   │
│  │                 MONTE CARLO ENDPOINTS                      │   │
│  │                                                            │   │
│  │  ┌───────────┐  ┌───────────┐  ┌───────────┐              │   │
│  │  │Distribution│  │Sensitivity│  │Confidence │              │   │
│  │  │ Endpoint  │  │ Endpoint  │  │ Endpoint  │              │   │
│  │  └───────────┘  └───────────┘  └───────────┘              │   │
│  └────────────────────────────────────────────────────────────┘   │
└────────────────────────────┬───────────────────────────────────────┘
                             │
                             ▼
┌────────────────────────────────────────────────────────────────────┐
│                      DATA EXTRACTION LAYER                         │
│                                                                    │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────────┐      │
│  │ Visualization │  │ Data          │  │ Format            │      │
│  │ Formatters    │  │ Transformers  │  │ Converters        │      │
│  └───────────────┘  └───────────────┘  └───────────────────┘      │
│                                                                    │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────────┐      │
│  │ Chart-Specific│  │ Time Series   │  │ Statistical       │      │
│  │ Adapters      │  │ Processors    │  │ Analyzers         │      │
│  └───────────────┘  └───────────────┘  └───────────────────┘      │
└────────────────────────────┬───────────────────────────────────────┘
                             │
                             ▼
┌────────────────────────────────────────────────────────────────────┐
│                      SIMULATION RESULTS LAYER                      │
│                                                                    │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────────┐      │
│  │ Metrics       │  │ Cashflows     │  │ Portfolio         │      │
│  │ Results       │  │ Results       │  │ Composition       │      │
│  └───────────────┘  └───────────────┘  └───────────────────┘      │
│                                                                    │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────────┐      │
│  │ Loan          │  │ Waterfall     │  │ Monte Carlo       │      │
│  │ Data          │  │ Distributions │  │ Scenarios         │      │
│  └───────────────┘  └───────────────┘  └───────────────────┘      │
└────────────────────────────────────────────────────────────────────┘
```

## Data Flow Architecture

```
┌───────────────┐     ┌───────────────┐     ┌───────────────────┐
│ Simulation    │     │ Simulation    │     │ Visualization     │
│ Parameters    │────▶│ Results       │────▶│ API Request       │
│               │     │               │     │                   │
└───────────────┘     └───────────────┘     └─────────┬─────────┘
                                                      │
                                                      ▼
┌───────────────┐     ┌───────────────┐     ┌─────────────────────┐
│ Visualization │     │ Chart-Specific│     │ Data Extraction     │
│ Response      │◀────│ Formatting    │◀────│ & Transformation    │
│               │     │               │     │                     │
└───────┬───────┘     └───────────────┘     └─────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────┐
│                       Frontend Charts                           │
│                                                                 │
│  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐    │
│  │ Bar/Line  │  │ Pie/Donut │  │ Area      │  │ Scatter   │    │
│  │ Charts    │  │ Charts    │  │ Charts    │  │ Plots     │    │
│  └───────────┘  └───────────┘  └───────────┘  └───────────┘    │
│                                                                 │
│  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐    │
│  │ Waterfall │  │ Histogram │  │ Tornado   │  │ Heat Maps │    │
│  │ Charts    │  │ Charts    │  │ Charts    │  │           │    │
│  └───────────┘  └───────────┘  └───────────┘  └───────────┘    │
└─────────────────────────────────────────────────────────────────┘
```

## Monte Carlo Parameter Selection Architecture

```
┌───────────────────────────────────────────────────────────────────┐
│                 Parameter Selection Configuration                 │
│                                                                   │
│  ┌─────────────────────────────────┐  ┌───────────────────────┐  │
│  │      Eligible Parameters        │  │  Non-Eligible Params  │  │
│  │                                 │  │                       │  │
│  │  ┌─────────────┐ ┌────────────┐ │  │ ┌─────────────────┐  │  │
│  │  │ Appreciation│ │ Default    │ │  │ │ Fund Structure  │  │  │
│  │  │ Rates       │ │ Rates      │ │  │ │                 │  │  │
│  │  └─────────────┘ └────────────┘ │  │ └─────────────────┘  │  │
│  │                                 │  │                       │  │
│  │  ┌─────────────┐ ┌────────────┐ │  │ ┌─────────────────┐  │  │
│  │  │ Exit        │ │ LTV        │ │  │ │ Waterfall       │  │  │
│  │  │ Timing      │ │ Ratios     │ │  │ │ Structure       │  │  │
│  │  └─────────────┘ └────────────┘ │  │ └─────────────────┘  │  │
│  │                                 │  │                       │  │
│  │  ┌─────────────┐ ┌────────────┐ │  │ ┌─────────────────┐  │  │
│  │  │ Interest    │ │ Market     │ │  │ │ Deployment      │  │  │
│  │  │ Rates       │ │ Conditions │ │  │ │ Parameters      │  │  │
│  │  └─────────────┘ └────────────┘ │  │ └─────────────────┘  │  │
│  └─────────────────────────────────┘  └───────────────────────┘  │
└───────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌───────────────────────────────────────────────────────────────────┐
│                 Variation Generation Engine                       │
│                                                                   │
│  ┌─────────────────────┐  ┌─────────────────────┐                │
│  │  Random Variable    │  │  Correlation        │                │
│  │  Generation         │  │  Control            │                │
│  └─────────────────────┘  └─────────────────────┘                │
│                                                                   │
│  ┌─────────────────────┐  ┌─────────────────────┐                │
│  │  Distribution       │  │  Parameter          │                │
│  │  Sampling           │  │  Transformation     │                │
│  └─────────────────────┘  └─────────────────────┘                │
└───────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌───────────────────────────────────────────────────────────────────┐
│                 Monte Carlo Simulation Engine                     │
│                                                                   │
│  ┌─────────────────────┐  ┌─────────────────────┐                │
│  │  Scenario           │  │  Parallel           │                │
│  │  Generation         │  │  Processing         │                │
│  └─────────────────────┘  └─────────────────────┘                │
│                                                                   │
│  ┌─────────────────────┐  ┌─────────────────────┐                │
│  │  Portfolio          │  │  Cashflow           │                │
│  │  Simulation         │  │  Calculation        │                │
│  └─────────────────────┘  └─────────────────────┘                │
└───────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌───────────────────────────────────────────────────────────────────┐
│                 Results Analysis Engine                           │
│                                                                   │
│  ┌─────────────────────┐  ┌─────────────────────┐                │
│  │  Statistical        │  │  Distribution       │                │
│  │  Analysis           │  │  Analysis           │                │
│  └─────────────────────┘  └─────────────────────┘                │
│                                                                   │
│  ┌─────────────────────┐  ┌─────────────────────┐                │
│  │  Sensitivity        │  │  Confidence         │                │
│  │  Analysis           │  │  Interval Analysis  │                │
│  └─────────────────────┘  └─────────────────────┘                │
└───────────────────────────────────────────────────────────────────┘
```

## Visualization API Workflow

```
┌────────────────┐     ┌────────────────┐     ┌────────────────┐
│ Client         │     │ API Gateway    │     │ Visualization  │
│ Application    │────▶│ Layer          │────▶│ Endpoint       │
│                │     │                │     │                │
└────────────────┘     └────────────────┘     └───────┬────────┘
                                                     │
                                                     ▼
┌────────────────┐     ┌────────────────┐     ┌────────────────┐
│ Chart          │     │ Data           │     │ Data           │
│ Component      │◀────│ Transformation │◀────│ Extraction     │
│                │     │ Layer          │     │ Layer          │
└────────────────┘     └────────────────┘     └───────┬────────┘
                                                     │
                                                     ▼
                                              ┌────────────────┐
                                              │ Simulation     │
                                              │ Results Store  │
                                              │                │
                                              └────────────────┘
```

## Risk & Performance Visualization Data Flow

```
┌───────────────────────────────────────────────────────────────────┐
│                    Risk Visualization Data Flow                   │
│                                                                   │
│  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐             │
│  │ Simulation  │──▶│ Risk Metrics│──▶│ Risk API    │             │
│  │ Results     │   │ Calculation │   │ Endpoint    │             │
│  └─────────────┘   └─────────────┘   └──────┬──────┘             │
│                                            │                      │
│                                            ▼                      │
│           ┌─────────────────────────────────────────────┐        │
│           │           Risk Visualization                │        │
│           │                                             │        │
│           │  ┌────────────┐  ┌────────────┐  ┌────────┐ │        │
│           │  │ Volatility │  │ Sharpe/    │  │ Max    │ │        │
│           │  │ Charts     │  │ Sortino    │  │Drawdown│ │        │
│           │  └────────────┘  └────────────┘  └────────┘ │        │
│           │                                             │        │
│           │  ┌────────────┐  ┌────────────┐  ┌────────┐ │        │
│           │  │ VaR/CVaR   │  │ Return     │  │Downside│ │        │
│           │  │ Analysis   │  │ Distribution│  │Deviation│ │        │
│           │  └────────────┘  └────────────┘  └────────┘ │        │
│           └─────────────────────────────────────────────┘        │
└───────────────────────────────────────────────────────────────────┘
```

## Waterfall & Zone Performance Visualization

```
┌────────────────────────────────────────────────────────────────┐
│            Waterfall & Zone Visualization Data Flows           │
│                                                                │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              Waterfall Visualization                    │   │
│  │                                                         │   │
│  │  ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌───────┐ │   │
│  │  │ Capital │    │Preferred│    │GP Catch-│    │Carried│ │   │
│  │  │ Return  │───▶│ Return  │───▶│ Up      │───▶│Interest│ │   │
│  │  └─────────┘    └─────────┘    └─────────┘    └───────┘ │   │
│  │        │             │              │             │     │   │
│  │        └─────────────┴──────────────┴─────────────┘     │   │
│  │                            │                            │   │
│  │                            ▼                            │   │
│  │                     ┌────────────┐                      │   │
│  │                     │ Total      │                      │   │
│  │                     │ Returns    │                      │   │
│  │                     └────────────┘                      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              Zone Performance Visualization             │   │
│  │                                                         │   │
│  │  ┌─────────┐    ┌─────────┐    ┌─────────┐             │   │
│  │  │ Green   │    │ Orange  │    │ Red     │             │   │
│  │  │ Zone    │    │ Zone    │    │ Zone    │             │   │
│  │  └────┬────┘    └────┬────┘    └────┬────┘             │   │
│  │       │              │               │                  │   │
│  │       ▼              ▼               ▼                  │   │
│  │  ┌─────────┐    ┌─────────┐    ┌─────────┐             │   │
│  │  │ IRR     │    │ Default │    │ Multiple│             │   │
│  │  │ Analysis│    │ Analysis│    │ Analysis│             │   │
│  │  └─────────┘    └─────────┘    └─────────┘             │   │
│  └─────────────────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────────────────┘
```

## Monte Carlo Visualization Components

```
┌──────────────────────────────────────────────────────────────────┐
│                Monte Carlo Visualization Components              │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │               Distribution Visualization                   │  │
│  │                                                            │  │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐           │  │
│  │  │ IRR        │  │ Multiple   │  │ Default    │           │  │
│  │  │ Histogram  │  │ Histogram  │  │ Rate Hist. │           │  │
│  │  └────────────┘  └────────────┘  └────────────┘           │  │
│  │                                                            │  │
│  │  ┌────────────────────────┐  ┌────────────────────────┐   │  │
│  │  │ Box & Whisker Plots    │  │ Statistical Summary    │   │  │
│  │  └────────────────────────┘  └────────────────────────┘   │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │               Sensitivity Visualization                    │  │
│  │                                                            │  │
│  │  ┌────────────────────────┐  ┌────────────────────────┐   │  │
│  │  │ Tornado Charts         │  │ Correlation Analysis   │   │  │
│  │  └────────────────────────┘  └────────────────────────┘   │  │
│  │                                                            │  │
│  │  ┌────────────────────────┐  ┌────────────────────────┐   │  │
│  │  │ Impact Heat Maps       │  │ Parameter Ranking      │   │  │
│  │  └────────────────────────┘  └────────────────────────┘   │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │               Confidence Visualization                     │  │
│  │                                                            │  │
│  │  ┌────────────────────────┐  ┌────────────────────────┐   │  │
│  │  │ Confidence Intervals   │  │ Percentile Charts      │   │  │
│  │  └────────────────────────┘  └────────────────────────┘   │  │
│  │                                                            │  │
│  │  ┌────────────────────────┐  ┌────────────────────────┐   │  │
│  │  │ Fan Charts             │  │ Probability Bands      │   │  │
│  │  └────────────────────────┘  └────────────────────────┘   │  │
│  └────────────────────────────────────────────────────────────┘  │
└──────────────────────────────────────────────────────────────────┘
```

## Loan Performance Visualization Components

```
┌──────────────────────────────────────────────────────────────────┐
│                Loan Performance Visualization                    │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │               Summary Metrics                              │  │
│  │                                                            │  │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐           │  │
│  │  │ Total      │  │ Default    │  │ Average    │           │  │
│  │  │ Loans      │  │ Rate       │  │ Metrics    │           │  │
│  │  └────────────┘  └────────────┘  └────────────┘           │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │               Loan Scatter Plot                            │  │
│  │                                                            │  │
│  │  ┌────────────────────────────────────────────────────┐   │  │
│  │  │                                                    │   │  │
│  │  │  * Green Zone Loans                                │   │  │
│  │  │                                                    │   │  │
│  │  │           * Orange Zone Loans                      │   │  │
│  │  │                                                    │   │  │
│  │  │                     * Red Zone Loans               │   │  │
│  │  │                                                    │   │  │
│  │  │  X Defaulted Loans                                 │   │  │
│  │  │                                                    │   │  │
│  │  │                                                    │   │  │
│  │  └────────────────────────────────────────────────────┘   │  │
│  │        LTV Ratio →                                        │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │               Loan Detail View                             │  │
│  │                                                            │  │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐           │  │
│  │  │ Size &     │  │ Term &     │  │ Exit &     │           │  │
│  │  │ LTV        │  │ Interest   │  │ Returns    │           │  │
│  │  └────────────┘  └────────────┘  └────────────┘           │  │
│  └────────────────────────────────────────────────────────────┘  │
└──────────────────────────────────────────────────────────────────┘
```

## Parameter Selection Dashboard for Monte Carlo

```
┌──────────────────────────────────────────────────────────────────┐
│                Parameter Selection Dashboard                     │
│                                                                  │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │ Monte Carlo Configuration                                 │  │
│  │                                                           │  │
│  │ Number of Simulations: [1000           ]  ┌──────────┐   │  │
│  │                                           │ ADVANCED  │   │  │
│  │ Random Seed:           [42              ] │ OPTIONS   │   │  │
│  │                                           └──────────┘   │  │
│  │ ┌───────────────────────────────────────────────────┐   │  │
│  │ │ Parallel Processing: [4] cores                    │   │  │
│  │ │ Output Format:       [Summary & Detail]           │   │  │
│  │ └───────────────────────────────────────────────────┘   │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │ Parameter Selection                                       │  │
│  │                                                           │  │
│  │  PARAMETER           ENABLED   VARIATION   CORRELATION    │  │
│  │  ─────────────────────────────────────────────────────    │  │
│  │  Appreciation Rates   [✓]      [±30%]      [High]         │  │
│  │  Default Rates        [✓]      [±50%]      [Medium]       │  │
│  │  Exit Timing          [✓]      [±2 years]  [Low]          │  │
│  │  LTV Ratios           [ ]      [±10%]      [Medium]       │  │
│  │  Interest Rates       [✓]      [±20%]      [Medium]       │  │
│  │  Market Conditions    [✓]      [Custom]    [High]         │  │
│  │                                                           │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │ Non-Eligible Parameters (Fixed)                    │  │  │
│  │  │ • Fund Structure (Size, Term, Fees)                │  │  │
│  │  │ • Waterfall Structure                              │  │  │
│  │  │ • Deployment Parameters                            │  │  │
│  │  │ • Fee Structure                                    │  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                                                           │  │
│  │  [ CANCEL ]     [ SAVE TEMPLATE ]     [ RUN SIMULATION ]  │  │
│  │                                                           │  │
│  └───────────────────────────────────────────────────────────┘  │
└──────────────────────────────────────────────────────────────────┘
```

## API Integration Architecture

```
┌──────────────────────────────────────────────────────────────────┐
│                     Frontend Integration                         │
│                                                                  │
│  ┌─────────────────┐    ┌─────────────────┐                     │
│  │ React Components│    │ Chart.js/D3.js  │                     │
│  └────────┬────────┘    └────────┬────────┘                     │
│           │                      │                              │
│           └──────────────────────┘                              │
│                      │                                          │
│                      ▼                                          │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Visualization API Client                                │   │
│  │                                                         │   │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐        │   │
│  │  │useChartData│  │useMonteCarlo│  │useRiskData│        │   │
│  │  │   Hook     │  │    Hook     │  │   Hook    │        │   │
│  │  └────────────┘  └────────────┘  └────────────┘        │   │
│  └─────────────────────────────────────────────────────────┘   │
└────────────────────────┬─────────────────────────────────────────┘
                         │
                         ▼
┌──────────────────────────────────────────────────────────────────┐
│                     Backend API Endpoints                        │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ /api/simulations/{id}/visualization?chart_type=X        │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ /api/simulations/{id}/monte-carlo/visualization         │   │
│  └─────────────────────────────────────────────────────────┘   │
└──────────────────────────────────────────────────────────────────┘
``` 